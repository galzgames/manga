# ğŸ”„ Fluxo de Dados - VisÃ£o Geral

Este documento explica como os dados fluem no seu sistema com Firebase.

---

## ğŸ“Š Arquitetura do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸŒ USUÃRIO NO NAVEGADOR                      â”‚
â”‚                      (index.html aberto)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ“± LocalStorage   â”‚            â”‚  ğŸ”¥ Firebase SDK   â”‚
        â”‚  (Cache Local)     â”‚            â”‚  (ConexÃ£o Nuvem)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   ğŸ”€ Sincronizar    â”‚
                     â”‚  Online/Offline     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ—„ï¸  FIRESTORE  â”‚  â”‚ ğŸ“¸ STORAGE   â”‚  â”‚ ğŸ“ HISTÃ“RICO   â”‚
        â”‚  (Banco Dados) â”‚  â”‚  (Capas)     â”‚  â”‚  (Movimentos)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Fluxo 1: Adicionar um MangÃ¡

```
1. UsuÃ¡rio preenche formulÃ¡rio
   â”œâ”€â”€ Nome, CÃ³digo, Autor, Volume
   â”œâ”€â”€ Estoque
   â”œâ”€â”€ PreÃ§o â† NOVO!
   â””â”€â”€ Capa (arquivo ou URL)

2. UsuÃ¡rio clica "Adicionar"
   â”‚
   â”œâ”€ Se hÃ¡ arquivo de capa:
   â”‚  â””â”€ Comprime e faz upload para Firebase Storage
   â”‚     â””â”€ Retorna URL da imagem
   â”‚
   â””â”€ Cria objeto MangÃ¡ com todos os dados

3. Salva Localmente (rÃ¡pido)
   â””â”€ localStorage.setItem('mangas', ...)

4. Sincroniza com Firebase (background)
   â”œâ”€ Envia para Firestore
   â”œâ”€ Salva histÃ³rico de estoque
   â””â”€ Se offline, fica na fila local

5. Renderiza na tela
   â””â”€ UsuÃ¡rio vÃª o mangÃ¡ adicionado imediatamente
```

### Diagrama de Tempo:

```
UsuÃ¡rio Clica "Adicionar"
    â”‚
    â”œâ”€â†’ [Imediato] Salva em localStorage
    â”‚   â””â”€â†’ Renderiza na tela (usuÃ¡rio vÃª logo)
    â”‚
    â”œâ”€â†’ [Background] Upload de capa (se houver)
    â”‚   â””â”€â†’ Firebase Storage
    â”‚
    â””â”€â†’ [Background] Sincroniza com Firebase
        â””â”€â†’ Firestore
            â””â”€â†’ Sucesso âœ… ou Fila (offline)

Total de latÃªncia visÃ­vel: ~1 segundo (muito rÃ¡pido!)
```

---

## ğŸ“‚ Fluxo 2: Carregar MangÃ¡s ao Abrir Site

```
1. PÃ¡gina carrega (DOMContentLoaded)

2. Verifica Firebase disponÃ­vel?
   â”œâ”€ Sim (online)
   â”‚  â”œâ”€ Carrega do Firebase Firestore
   â”‚  â”œâ”€ Carrega histÃ³rico
   â”‚  â””â”€ Atualiza cache local
   â”‚
   â””â”€ NÃ£o (offline ou erro)
      â””â”€ Carrega do localStorage como fallback

3. Renderiza mangÃ¡s na tela
   â””â”€ UsuÃ¡rio vÃª sua coleÃ§Ã£o

Tempo total: 1-2 segundos
```

---

## ğŸ–¼ï¸ Fluxo 3: Upload de Capa

```
UsuÃ¡rio seleciona imagem
    â”‚
    â”œâ”€ ValidaÃ§Ã£o (tipo, tamanho)
    â”‚
    â”œâ”€ CompressÃ£o AutomÃ¡tica
    â”‚  â”œâ”€ Redimensiona para 500px largura
    â”‚  â”œâ”€ Qualidade JPEG 80%
    â”‚  â””â”€ Resultado: 50-200KB (vs 2-10MB original)
    â”‚
    â”œâ”€ Upload para Firebase Storage
    â”‚  â”œâ”€ Pasta: /capas/
    â”‚  â”œâ”€ Nome: manga_[timestamp].jpg
    â”‚  â””â”€ Gera URL pÃºblica
    â”‚
    â””â”€ Salva URL no Firestore
       â””â”€ DisponÃ­vel para sempre

Tempo: 1-3 segundos (depende do tamanho)
```

---

## ğŸ”„ Fluxo 4: SincronizaÃ§Ã£o Online/Offline

### ONLINE (Conectado):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UsuÃ¡rio adiciona mangÃ¡                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Salva Local OK â”‚ â† RÃ¡pido!
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Sincroniza Firebaseâ”‚ â† AutomÃ¡tico
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ âœ… Sucesso!    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OFFLINE (Sem Internet):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UsuÃ¡rio adiciona mangÃ¡                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Salva Local OK â”‚ â† RÃ¡pido!
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Tenta sincronizar        â”‚
         â”‚ Falha (sem internet)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Fica em fila local       â”‚
         â”‚ âš ï¸ Aviso: VocÃª estÃ¡     â”‚
         â”‚    offline               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    [UsuÃ¡rio ativa Wi-Fi]
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Sincroniza automaticamenteâ”‚
         â”‚ âœ… Sucesso!              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Fluxo 5: Buscar no Mercado Livre

```
UsuÃ¡rio digita ISBN/CÃ³digo
    â”‚
    â”œâ”€ API Google Books
    â”‚  â””â”€ Retorna capa + info
    â”‚
    â””â”€ API Mercado Livre Brasil
       â”œâ”€ Retorna capa + preÃ§o â† NOVO!
       â””â”€ UsuÃ¡rio clica para preencher preÃ§o
```

---

## ğŸ’¾ Onde Cada Tipo de Dado Ã© Armazenado

### Dados do MangÃ¡ (Nome, Autor, etc)
```
LOCAL:    localStorage (backup)
NUVEM:    Firestore (primÃ¡rio)
         â””â”€ ColeÃ§Ã£o: "mangas"
           â””â”€ Documento: [ID]
             â”œâ”€ codigo
             â”œâ”€ nome
             â”œâ”€ autor
             â”œâ”€ volume
             â”œâ”€ estoque
             â”œâ”€ preco â† NOVO!
             â”œâ”€ localizacao
             â””â”€ capa (URL)
```

### Imagens das Capas
```
LOCAL:    Nenhum (apenas URL)
NUVEM:    Firebase Storage (primÃ¡rio)
         â””â”€ Pasta: /capas/
           â””â”€ Arquivos: manga_[ID].jpg
```

### HistÃ³rico de Estoque
```
LOCAL:    localStorage (backup)
NUVEM:    Firestore (primÃ¡rio)
         â””â”€ ColeÃ§Ã£o: "historicoEstoque"
           â””â”€ Documento: [MangaID]
             â””â”€ movimentacoes: []
```

---

## ğŸ“Š Limites e Quotas

### Firebase Firestore (Banco de Dados)
```
Limite Gratuito:
â”œâ”€ 1 GB de armazenamento
â”œâ”€ 50.000 leituras/dia
â”œâ”€ 20.000 escritas/dia
â””â”€ Suficiente para: 100+ mangÃ¡s

Para 1000 mangÃ¡s:
â”œâ”€ ~100 MB (Firestore)
â””â”€ Ainda no limite gratuito
```

### Firebase Storage (Capas)
```
Limite Gratuito:
â”œâ”€ 5 GB de armazenamento
â””â”€ Suficiente para: 5000 capas (comprimidas)

Tamanho mÃ©dio capa comprimida:
â”œâ”€ Original: 2-10 MB
â”œâ”€ Comprimida: 100-300 KB
â””â”€ Taxa de compressÃ£o: 10x a 50x
```

---

## ğŸ” Fluxo de SeguranÃ§a (Modo Teste)

```
Atualmente (MODO TESTE):
â”œâ”€ Qualquer pessoa pode ler dados
â”œâ”€ Qualquer pessoa pode escrever dados
â””â”€ OK para desenvolvimento/teste

Para ProduÃ§Ã£o:
â”œâ”€ Adicionar Firebase Authentication
â”œâ”€ Cada usuÃ¡rio faz login
â”œâ”€ Cada usuÃ¡rio vÃª sÃ³ seus dados
â””â”€ Dados criptografados em trÃ¢nsito
```

---

## ğŸ“ˆ Escalabilidade

### Pode crescer para:
- âœ… 10.000 mangÃ¡s (ainda grÃ¡tis)
- âœ… 100 usuÃ¡rios simultÃ¢neos (plano gratuito)
- âœ… 1.000 usuÃ¡rios com autenticaÃ§Ã£o

### Se precisar de mais:
- Upgrade para plano pago
- Custos: ~$0.06 por 100.000 leituras
- Sempre com free tier incluÃ­do

---

## ğŸ”„ Ciclo Completo Exemplo

### UsuÃ¡rio Novo

```
1. Abre site
   â””â”€ Carrega index.html
   
2. Firebase carrega
   â””â”€ Verifica credenciais (firebase-config.js)
   
3. Busca dados
   â”œâ”€ Conecta a Firestore
   â”œâ”€ Conecta a Storage
   â””â”€ Cache em localStorage

4. Renderiza interface
   â””â”€ "Nenhum mangÃ¡ encontrado"

5. UsuÃ¡rio adiciona 1Âº mangÃ¡
   â”œâ”€ Preenche formulÃ¡rio
   â”œâ”€ Seleciona capa
   â””â”€ Clica Adicionar

6. Sistema processa
   â”œâ”€ Comprime capa
   â”œâ”€ Upload para Storage
   â”œâ”€ Salva em Firestore
   â”œâ”€ Salva em localStorage
   â””â”€ Renderiza na tela

7. Pronto!
   â””â”€ Dados sincronizados em 3 lugares:
      â”œâ”€ localStorage (local)
      â”œâ”€ Firestore (nuvem)
      â””â”€ Storage (capas)

Tempo total: 2-5 segundos
```

---

## ğŸ¯ Resumo

| AÃ§Ã£o | Onde vai | Velocidade | RedundÃ¢ncia |
|------|----------|-----------|------------|
| Dados mangÃ¡ | Firestore + localStorage | 1-2s | Duplo |
| Capa imagem | Storage + localStorage (URL) | 1-3s | Duplo |
| HistÃ³rico | Firestore + localStorage | 1-2s | Duplo |
| Busca | Cache local â†’ Firestore | 10-100ms | Local |
| Offline | localStorage | Imediato | Sim |
| SincronizaÃ§Ã£o | Firestore | Background | AutomÃ¡tica |

---

**ConclusÃ£o:** Seu sistema Ã© redundante, rÃ¡pido e funciona offline! ğŸš€
