# ğŸ” SeguranÃ§a - Guia Essencial

Este documento explica como manter seus dados seguros com Firebase.

---

## âš ï¸ Estado Atual: MODO TESTE (NÃƒO Ã© seguro para produÃ§Ã£o)

Atualmente, qualquer pessoa que acessa a pÃ¡gina pode:
- âœ… Ler todos os seus dados
- âœ… Adicionar mais dados
- âœ… Deletar seus dados
- âœ… Deletar capas

**Ã‰ OK para:**
- âœ… Desenvolvimento pessoal
- âœ… Testes
- âœ… Uso familiar em rede privada

**NÃƒO Ã© OK para:**
- âŒ Dados pÃºblicos na internet
- âŒ ProduÃ§Ã£o com mÃºltiplos usuÃ¡rios
- âŒ Dados sensÃ­veis/confidenciais

---

## ğŸ”’ Camadas de SeguranÃ§a

### 1. Credenciais do Firebase (firebase-config.js)

**O que Ã©:**
- API Key pÃºblica (nÃ£o Ã© tÃ£o secreta quanto parece)
- Project ID
- Endpoints do seu projeto

**Risco:**
- Se alguÃ©m tem isso, consegue acessar seus dados
- NÃƒO Ã© uma senha

**Como Proteger:**
- âœ… Arquivo jÃ¡ estÃ¡ em `.gitignore`
- âœ… NÃƒO suba para GitHub pÃºblico
- âœ… NÃƒO compartilhe com ninguÃ©m
- âœ… Se vazar, delete o projeto e cria outro

```javascript
// âŒ ERRADO: Nunca faÃ§a isso
// Expor em comentÃ¡rios pÃºblicos
// const firebaseConfig = { ... } // CREDENCIAIS REAIS!

// âœ… CORRETO: Guarde seguro
// NÃ£o publique arquivo em pÃºblico
// NÃ£o compartilhe credenciais
```

---

### 2. Firestore Security Rules

**SituaÃ§Ã£o Atual:**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;  // âŒ INSEGURO!
    }
  }
}
```

**Problema:** Qualquer pessoa pode ler/escrever tudo

**SoluÃ§Ã£o Segura (com AutenticaÃ§Ã£o):**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Apenas usuÃ¡rios logados podem acessar
    match /mangas/{userId}/{document=**} {
      allow read, write: if request.auth != null 
                         && request.auth.uid == userId;
    }
  }
}
```

---

### 3. Storage Security Rules

**SituaÃ§Ã£o Atual:**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if true;  // âŒ INSEGURO!
    }
  }
}
```

**SoluÃ§Ã£o Segura:**
```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /capas/{userId}/{filename} {
      allow read: if true;  // Qualquer um pode ver
      allow write, delete: if request.auth != null 
                           && request.auth.uid == userId;
    }
  }
}
```

---

### 4. AutenticaÃ§Ã£o (Firebase Auth)

**O que Ã©:**
- Sistema de login/logout
- Valida identidade do usuÃ¡rio
- Conecta com Firestore Rules

**Tipos Suportados:**
- Email/Senha â† Mais simples
- Google â† Recomendado
- GitHub
- Facebook
- Etc.

**Como Implementar (BÃ¡sico):**

```javascript
// Habilitar Email/Senha:
// 1. Firebase Console â†’ Authentication
// 2. Sign-in method â†’ Email/Password
// 3. Ativar

// FunÃ§Ã£o de Login
async function login(email, password) {
    try {
        const result = await firebase.auth()
            .signInWithEmailAndPassword(email, password);
        console.log('âœ… Logado como:', result.user.email);
        return result.user;
    } catch (error) {
        console.error('âŒ Erro ao logar:', error);
    }
}

// FunÃ§Ã£o de Logout
async function logout() {
    await firebase.auth().signOut();
    console.log('âœ… Deslogado');
}

// Verificar se estÃ¡ logado
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        console.log('âœ… UsuÃ¡rio logado:', user.email);
    } else {
        console.log('âš ï¸ Nenhum usuÃ¡rio logado');
    }
});
```

---

## ğŸ›¡ï¸ Checklist de SeguranÃ§a

### Desenvolvimento (OK como estÃ¡)
- [x] firebase-config.js nÃ£o estÃ¡ pÃºblico
- [x] localStorage criptografa automaticamente
- [x] Dados sÃ³ acessÃ­veis localmente

### Para ProduÃ§Ã£o

**ANTES de publicar:**
- [ ] Ativar Firebase Authentication
- [ ] Implementar login/logout
- [ ] Atualizar Firestore Rules
- [ ] Atualizar Storage Rules
- [ ] Testar regras de seguranÃ§a
- [ ] Validar dados no servidor
- [ ] Ativar HTTPS
- [ ] Configurar CORS
- [ ] Fazer backup dos dados

---

## ğŸ“‹ ImplementaÃ§Ã£o de AutenticaÃ§Ã£o (Passo a Passo)

### Passo 1: Ativar Auth no Firebase

1. Firebase Console â†’ **Authentication**
2. **Sign-in method** â†’ **Email/Password**
3. Ativar
4. **Users** vocÃª gerencia quem acessa

### Passo 2: Adicionar Tela de Login

```html
<!-- Adicione em index.html -->
<div id="auth-container" style="display: none; padding: 20px;">
    <h2>Login</h2>
    <input type="email" id="login-email" placeholder="Email">
    <input type="password" id="login-password" placeholder="Senha">
    <button onclick="handleLogin()">Entrar</button>
    <button onclick="handleSignup()">Criar Conta</button>
    <button onclick="handleLogout()">Sair</button>
</div>
```

### Passo 3: FunÃ§Ãµes de Auth

```javascript
async function handleLogin() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        const result = await firebase.auth()
            .signInWithEmailAndPassword(email, password);
        console.log('âœ… Logado!');
        showMangaManager();  // Mostra o app principal
    } catch (error) {
        console.error('âŒ Erro:', error.message);
        alert('Erro ao fazer login: ' + error.message);
    }
}

async function handleSignup() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        const result = await firebase.auth()
            .createUserWithEmailAndPassword(email, password);
        console.log('âœ… Conta criada!');
        showMangaManager();
    } catch (error) {
        console.error('âŒ Erro:', error.message);
    }
}

async function handleLogout() {
    await firebase.auth().signOut();
    console.log('âœ… Deslogado');
    showLoginScreen();  // Volta para tela de login
}

// Verificar estado de auth
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        console.log('âœ… UsuÃ¡rio:', user.email);
        showMangaManager();
    } else {
        console.log('âš ï¸ NÃ£o logado');
        showLoginScreen();
    }
});
```

### Passo 4: Atualizar Firestore Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Dados do usuÃ¡rio - apenas ele acessa
    match /users/{userId}/mangas/{document=**} {
      allow read, write: if request.auth.uid == userId;
    }
    
    // HistÃ³rico do usuÃ¡rio
    match /users/{userId}/historico/{document=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
```

### Passo 5: Atualizar Storage Rules

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
```

---

## ğŸ” Verificar SeguranÃ§a

### No Firebase Console

1. **Firestore** â†’ **Dados** â†’ Veja as coleÃ§Ãµes
2. **Storage** â†’ Veja as pastas
3. **Authentication** â†’ Veja os usuÃ¡rios

### Testar Acesso

1. Crie outra conta com email diferente
2. Verifique que vÃª APENAS seus dados
3. Verifique que NÃƒO consegue alterar dados de outros

---

## ğŸš¨ Se Credenciais Vazarem

**O que fazer imediatamente:**

1. VÃ¡ para Firebase Console
2. Revogue as chaves:
   - Settings â†’ Project settings
   - Regenerate API keys
3. Crie novo projeto do zero
4. Configure novamente
5. Atualize firebase-config.js

**NÃ£o Ã© o fim do mundo porque:**
- API Key sozinha nÃ£o faz nada
- Sem as Rules corretas, Ã© bloqueada
- Com Rules corretas, sÃ³ acessa dados permitidos

---

## ğŸ’¡ Boas PrÃ¡ticas

âœ… **Fazer:**
- Guardar credenciais em `.gitignore`
- Usar HTTPS sempre (localhost OK)
- Validar dados no servidor (Firestore Rules)
- Fazer backup regularmente
- Monitorar acessos (Firebase Logs)
- Revogar acesso de usuÃ¡rios nÃ£o usados
- Atualizar Firebase SDK periodicamente

âŒ **NÃƒO Fazer:**
- Compartilhar firebase-config.js
- Committar credenciais no Git pÃºblico
- Confiar APENAS em validaÃ§Ã£o do cliente
- Deixar modo teste em produÃ§Ã£o
- Armazenar senhas em claro
- Esquecer de fazer backup

---

## ğŸ“Š Monitoramento

### No Firebase Console

**Authentication:**
```
Monitore:
â”œâ”€ UsuÃ¡rios ativos
â”œâ”€ Tentativas de login falhadas
â”œâ”€ Novas contas criadas
â””â”€ Atividade suspeita
```

**Firestore:**
```
Monitore:
â”œâ”€ NÃºmero de documentos
â”œâ”€ Tamanho total
â”œâ”€ Leituras/escritas por dia
â””â”€ LatÃªncia de queries
```

**Storage:**
```
Monitore:
â”œâ”€ NÃºmero de arquivos
â”œâ”€ Tamanho total
â”œâ”€ Uploads/downloads
â””â”€ EspaÃ§o ainda disponÃ­vel
```

---

## ğŸ¯ Resumo

| Aspecto | Atual | ProduÃ§Ã£o |
|--------|-------|----------|
| SeguranÃ§a | âš ï¸ Modo teste | âœ… Com Auth |
| AutenticaÃ§Ã£o | âŒ Nenhuma | âœ… Email/Google |
| Firestore Rules | âŒ Aberto | âœ… Por usuÃ¡rio |
| Storage Rules | âŒ Aberto | âœ… Por usuÃ¡rio |
| Dados | ğŸ”“ PÃºblicos | ğŸ”’ Privados |

---

## ğŸ“ Precisa de Ajuda?

- [Firebase Security Guide](https://firebase.google.com/docs/rules)
- [Authentication Docs](https://firebase.google.com/docs/auth)
- [Console Firebase](https://console.firebase.google.com/)

---

**Lembre-se:** SeguranÃ§a Ã© uma jornada, nÃ£o um destino! ğŸ›¡ï¸
